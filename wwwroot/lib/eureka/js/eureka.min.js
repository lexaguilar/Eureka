function setHTMLFromEntity(n,t="",i=[]){for(const r in n)if(n.hasOwnProperty(r)){const f=n[r];let u=getModelByColumnName(r,t);u&&(i.some(n=>n==r)||(u.clearValue(),u.type!=stores.types.select?u.setValue(f):setValueSelect(u,n)))}}function setValueSelect(n,t){if(n.hasDependency()){let i=n.itemDependency.map(n=>{let i=findModel(n);return t[i.columnName||i.id]});if(!i.some(n=>n==null)){let r=buildUrlWithValues(n.url,i);$("#"+n.id).loadCatalog({defaultValue:t[n.columnName||n.id],silent:!0,url:r})}}else $("#"+n.id).loadCatalog({defaultValue:t[n.columnName||n.id],silent:!0})}var stores={types:{email:"email",phone:"phone",money:"money",check:"check",select:"select",date:"date",input:"input",td:"td",editable:"editable"}}(function(n){function f(n,t,f,e){var s="",o;if(t>n){var c=1,l=n,h=Math.floor(n/2);for(f>2&&f<=t-h&&(c=parseInt(f)-h,l=parseInt(f)+h),f>t-h&&(c=t-n+1,l=t),s+=i(o,f,"double-left",e),s+=i(o,f,"left",e),o=c;o<=l;o++)s+=u(o,f,e);s+=r(o,f,"right",t,e);s+=r(o,f,"double-right",t,e)}else for(o=1;o<=t;o++)s+=u(o,f,e);return s}function i(n,i,r,u){var f="";return 1!=i&&(f=t().replace("{act?}","").replace("{entity}",u).replace("{pag}",r=="double-left"?1:parseInt(i)-1).replace("{pag}",'<span class="fa fa-angle-'+r+' fa-color-black"><\/span>')),f}function r(n,i,r,u,f){var e="";return u!=i&&(e=t().replace("{act?}","").replace("{entity}",f).replace("{pag}",r=="double-right"?u:parseInt(i)+1).replace("{pag}",'<span class="fa fa-angle-'+r+' fa-color-black"><\/span>')),e}function u(n,i,r){return t().replace("{act?}",n==i?" active":"").replace("{pag}",n).replace("{entity}",r).replace("{pag}",n)}function t(){return'<button type="button" class="btn {act?}" onclick="load({pag},{entity})">{pag}<\/button>'}n.fn.loadCatalog=function(t){var i=n.extend({verb:"get",defaultValue:null,failCallback:undefined,lock:!1,defaultValueLock:null,url:null,open:!1,silent:!1,render:""},t),r=this;return new Promise((t,u)=>{n(r).each(function(){var f=n(this),r=findModel(n(f).attr("id")),s=findSelectize(r.elemt||r.id),h=i.render||r.render,o,e;if(n(f).loadingShow(!0),o=r=>(fillSelect(s,r,{render:h,defaultValue:i.defaultValue,open:i.open},i.lock,i.silent),n(f).loadingShow(!1),t(r)),e=i.url||findUrl(r),e.length>0)ajax.get(r.routePrefix+e,null,o,i.failCallback);else return n(f).loadingShow(!1),e==-1?t(0):u("No contiene url el model: "+r.id)})})};n.fn.clearCatalog=function(){return n(this).each(function(){var t=n(this),i=findSelectize(n(t).attr("id"));i.selectize.clearOptions()})};n.fn.loadData=function(t,i,r){return new Promise(u=>{this.each(function(){var o=n(this),e=n(o).attr("data-row")||10,h,c;let s=i||1,l=t.GetPartialKey(),a={id:l,page:s,rows:e};h=i=>{var r,l,y,c,d;if(i.total){r=i.data;l="<thead><tr>";for(y in r[0])l+="<th>"+y+"<\/th>";l+="<\/tr><\/thead>";var v="<tbody>",p="",w=0;for(c=0;c<r.length;c++){for(const n in r[c])if(r[c].hasOwnProperty(n)){const t=r[c][n];p+=`<td>${t}</td>`;w++}v+="<tr>"+p+"<\/tr>"}v+="<\/tbody>";var a="",b=0,h=i.total;if(b=h%e>0?Math.floor(h/e)+1:h/e,h>e){var g=s*e-(e-1),k=s*e,nt='<p style="float:left;">Montrando de '+g+" a "+(h<k?h:k)+" de unos "+h+"<\/p>";a+='<tfoot><tr><td colspan="'+w+'">'+nt+'<div class="btn-group" role="group" aria-label="..." style="float:right;">';a+=f(5,b,s,t.name)}a+="<\/div><\/td><\/tr><\/tfoot>";n(o).html('<table class="table">'+l+v+a+"<\/table>");n(o).attr("data-row",10);d=n(o).parent().attr("id");n('a[href$="'+d+'"]').find("span.badge").html(r.length);u()}};c=buildUrlWithValues(t.urlGetPartial,[r]);ajax.get(c,a,h)})})};n.fn.addRow=function(t){return this.each(function(){var u=n(this),i=n("<tr><\/tr>");for(var r in t)if(t.hasOwnProperty(r)){const u=t[r];n(i).append(`<td>${u}</td>`)}n(u).find("tbody").append(i)})};n.fn.updateFooter=function(t){return this.each(function(){var i=n(this),r;t.length?(r=n(i).find("tfoot tr td").eq(0).attr("data-page"),n(i).find("tfoot tr td").eq(0).attr("data-page",r+1)):n(i).find("tfoot tr td").eq(0).html("")})};n.fn.loadingShow=function(t){n(this).each(function(){var i=n(this);t?n(i).parent().children().find("div.selectize-input").append('<span><div class="inner" style="width: 16px;position: absolute;top: 5px;background:#ffffff00;"><div id="stock-preview-box" ld-spinner-preview="" ng-config="config" ng-ctrl="demo" ng-mod="mod" style="width:100%;height:100%;margin:0;padding:0;" class="ng-isolate-scope"><div class="lds-svg ng-scope"><svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-dual-ring"><circle cx="50" cy="50" ng-attr-r="{{config.radius}}" ng-attr-stroke-width="{{config.width}}" ng-attr-stroke="{{config.stroke}}" ng-attr-stroke-dasharray="{{config.dasharray}}" fill="none" stroke-linecap="round" r="40" stroke-width="15" stroke="#8cd0e5" stroke-dasharray="62.83185307179586 62.83185307179586" transform="rotate(272.85 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;360 50 50" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"><\/animateTransform><\/circle><\/svg><\/div><div class="lds-css ng-scope"><div style="width:100%;height:100%" class="lds-dual-ring"><div><\/div><\/div><\/div><\/div><\/div><\/span>'):n(i).parent().find("div.selectize-control").find("div.selectize-input").find("span").remove()})};n.fn.addError=function(t){return this.each(function(){n(this).parent().find("label.error").remove();n(this).parent().find("label.warn").remove();let i="right : -3px;";this.tagName=="A"&&(i=`left : 3px;`);n(`<label for="${this.id}" class="error" style="${i}display:none">${t}</label>`).insertBefore(this);setTimeout(()=>{n("label.error").fadeIn()},300);setTimeout(()=>{n("label.error").fadeOut(function(){n("label.error").remove()})},3e3)})};n.fn.addWarn=function(t){return this.each(function(){n(this).parent().find("label.warn").remove();n(this).parent().find("label.error").remove();let i="right : -3px;";this.tagName=="A"&&(i=`left : 3px;`);n(`<label for="${this.id}" class="warn" style="${i}display:none">${t}</label>`).insertBefore(this);setTimeout(()=>{n("label.warn").fadeIn()},300);setTimeout(()=>{n("label.warn").fadeOut(function(){n("label.warn").remove()})},3e3)})};n.fn.extend({animateCss:function(t,i){this.addClass("animated "+t).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){n(this).removeClass("animated "+t);i&&i()});return this}});n.fn.btnLoading=function(t){return this.each(function(){var i=n(this);n(i).html((t||"Buscando...")+' <span class="fa fa-spinner fa-pulse"><\/span>');n(i).attr("loading",!0)})};n.fn.btnDefault=function(t,i){return this.each(function(){var r=n(this);n(r).html((t||"Buscar...")+' <span class="fa fa-'+(i||"search")+'"><\/span>');n(r).removeAttr("loading")})};n.fn.isLoading=function(t){let i=!1;return this.each(function(){var r=n(this);n(r).attr("loading")&&(n.notify({message:t||"Proceso en curso"},{type:"warning "}),i=!0)}),i}}(jQuery)),Interface;Array.prototype.add||function(){Array.prototype.add=function(n){this.push(n)}}();Array.prototype.getOnlyColumns||function(){Array.prototype.getOnlyColumns=function(){var n=[];return _entities.forEach(t=>{n.add(t.models)}),modelss.flat()}}();Array.prototype.isValidTo||function(){Array.prototype.isValidTo=function(n){var t=!0;let i=[];for(let r of this)r[n]()&&(r.isValid()||(r.showError(),t=!1,i.push(r))),t&&(t=validate.model(r),t||i.push(r));return t||i[0].tabName&&$('a[href="#'+i[0].tabName+'"').tab("show"),t}}();HTMLElement.prototype.getValue=function(){return this.getAttribute("data-value")};HTMLElement.prototype.setValue=function(n){let t=String(n).money();return this.innerText=t,this.value=t,this.setAttribute("data-value",n)};Number.prototype.if=function(n){var t=this.valueOf();return n?{then:function(n){return+t+n}}:{then:function(){return+t}}};Number.prototype.less=function(n){var t=this.valueOf();return{"if":function(i){return i?+t-n:+t}}};Array.prototype.sum||(Array.prototype.sum=function(n){return n?this.reduce((t,i)=>+t+ +i[n],0):this.reduce((n,t)=>+n+ +t,0)});Array.prototype.update||(Array.prototype.update=function(n,t){this.map(i=>{var[u,,f]=t,r;if(i[u]==f)for(r=0;r<n.length;r++)i[n[r][0]]=n[r][1];return i})});Array.prototype.where||(Array.prototype.where=function(n,t){"use strict";if(!((typeof n=="Function"||typeof n=="function")&&this))throw new TypeError;var f=this.length>>>0,u=new Array(f),r=this,e=0,i=-1;if(t===undefined)while(++i!==f)i in this&&n(r[i],i,r)&&(u[e++]=r[i]);else while(++i!==f)i in this&&n.call(t,r[i],i,r)&&(u[e++]=r[i]);return u.length=e,u});String.prototype.money=function(){var n=currentConfiguration();return`${n.moneda} ${this}`};Number.prototype.percent=function(n){var t=this.valueOf();return t*n/100};String.prototype.percent=function(n){return parseFloat(this.valueOf()).percent(n)};Number.prototype.between=function(n,t){var i=this.valueOf();return i<n?n:i>t?t:i};String.prototype.between=function(n,t){var i=this.valueOf();return i<n?n:i>t?t:i};Interface=function(n,t){if(arguments.length!=2)throw new Error("Interface constructor called with &quot; + arguments.length arguments, but expected exactly 2");this.name=n;this.methods=[];for(var i=0,r=t.length;i<r;i++){if(typeof t[i]!="string")throw new Error("Interface constructor expects method names to be passed in as a string.");this.methods.push(t[i])}};Interface.ensureImplements=function(n){var i,f,t,r,e,u;if(arguments.length<2)throw new Error("Function Interface.ensureImplements called with "+arguments.length+" arguments, but expected at least 2");for(i=1,f=arguments.length;i<f;i++){if(t=arguments[i],t.constructor!==Interface)throw new Error("Function Interface.ensureImplements expects arguments two and above to be instances of Interface.");for(r=0,e=t.methods.length;r<e;r++)if(u=t.methods[r],!n[u]||typeof n[u]!="function")throw new Error("Function Interface.ensureImplements: object does not implement the "+t.name+" interface. Method "+u+" was not found.");}};var findRecord=(n,t)=>Object.entries(n).find(n=>n[0]==t)[1],findSelectize=n=>{let t=$selectizies.filter((t,i)=>i.id==n);if(t.length)return t[0];throw Error(`No se encontró en la lista elemento con id ${n}, verifique si lo agregó`);},fillSelect=(n,t,i,r,u=false)=>{var f=n.selectize,e;r?f.lock():f.unlock();f.clearOptions();f.addOption(t);e=findModel(f.$input[0].id);e.onLoad(t);t.length==1?(f.setValue(t[0].id,u),f.lock()):i.defaultValue!=null||i.defaultValue!=undefined?f.setValue(i.defaultValue,u):i.open&&f.open();i.render&&(f.clearCache(),f.settings.render=i.render)},findUrl=n=>{var f=!0,t=n.url,i,r,u;if(t.length==0){if(typeof n._url=="function")return n.url=n._url(),findUrl(n);throw new Error("No se encontro la url para el modelo "+n.id);}while(t.includes("{")||t.includes("}"))if(i=t.substring(t.indexOf("{"),t.indexOf("}")+1),r=findModel(i.replace("{","").replace("}","")),u=r.getValue(),validate.validateField(u))t=t.replace(i,u);else return showError(r),f=!1,-1;return f?t:null},findEntity=n=>_entities.find(t=>t.name==n),findModel=n=>{var t=getModel(n);if(t==null)throw new Error(`No se encontró el model «${n}», verifique que se agregó a la coleccion _models`);return t},getModel=n=>{let t=null;for(var i=0;i<_entities.length;i++)t||(t=_entities[i].models.find(t=>t.id==n));return t==undefined?null:t},findModelByColumnName=(n,t)=>{var i=getModelByColumnName(n,t);if(i==null)throw new Error(`No se encontró el model «${id}» para la entidad «${t}», verifique que se configuro en la entidad «${t}»`);return i},getModelByColumnName=(n,t)=>{let i=null;var r=_entities.find(n=>n.name==t);if(!r)throw new Error(`No se encontró la entidad «${t}», verifique que se agregó a la coleccion _entities`);return(i=r.models.find(t=>t.columnName==n||t.id==n),i==undefined)?null:i},modelsToArray=n=>{let t=[];return n.forEach(n=>{t.add(n.models)}),t.flat()},filterModelsByPagePosition=n=>_entities.getOnlyColumns().where(t=>t.pagePosition==n),filterModelsByAction=n=>_entities.getOnlyColumns().where(t=>t[n].call()),compareOr=n=>({"with":(...t)=>t.some(t=>t==n)}),sum=(...n)=>n.sum(),getValueByTag={email:function(n){return this.input(n)},phone:function(n){return this.input(n)},money:n=>$elemt("#"+n).getValue(),check:n=>$elemt("#"+n).checked,select:function(n){return this.input(n)},date:function(n){var i=this.input(n),t=moment(i,"DD-MM-YYYY");return t._isValid?moment(t,"DD-MM-YYYY").utc().format():""},input:n=>$elemt("#"+n).value,td:n=>$elemt("#"+n).getValue(),editable:function(n){return $("#"+n).editable("getValue")[n]}},setValueByTag={email:function(n,t){this.input(n,t)},phone:function(n,t){this.input(n,t)},money:function(n,t){$(n).setValue(t)},check:function(n,t){$(n).prop("checked",t)},select:function(n,t){$("#"+n).loadCatalog({defaultValue:t})},date:function(n,t){var i=moment(t);i._isValid&&$("#"+n).datepicker("setDate",i.format("DD-MM-YYYY"))},input:function(n,t){document.querySelector("#"+n).value=t},td:function(n,t){$elemt("#"+n).setValue(t)},editable:function(n,t){return $("#"+n).editable("setValue",t,!0)}},clearValueByTag={email:function(n){this.input(n)},phone:function(n){this.input(n)},money:function(n){$(n).setValue(0)},check:function(n){$(n).prop("checked",!1)},select:function(n){$("#"+n).clearCatalog()},date:function(n){var t=moment();$("#"+n).datepicker("setDate",t.format("DD-MM-YYYY"))},input:function(n){document.querySelector("#"+n).value=""},td:function(n){$elemt("#"+n).setValue(0)},editable:function(n){return $("#"+n).editable("setValue","",!0)}},getDatePart=(n,t)=>{var i=moment($("#"+n).val(),"MM/YYYY");return i._isValid?i.format(t):0},$elemt=n=>document.querySelector(n),showError=n=>{switch(n.type){case stores.types.email:case stores.types.phone:case stores.types.money:case stores.types.date:case stores.types.input:$("#"+n.id).addClass("isEmpty").addError(n.messageEmpty);break;case stores.types.select:$("#"+n.id+"-selectized").parent().addClass("isEmpty");$("#"+n.id).addError(n.messageEmpty)}},section={next:function(){var n=getCurrentSection(),t=filterModelsByPagePosition(n);t.isValidTo("requiredNextPage")?this.move(1,!0):goToUp()},prev:function(){this.move(-1,!1)},move:function(n){var t=getCurrentSection();$($(".page")[t]).fadeOut("fast",function(){$($(".page")[t+n]).fadeIn("fast");goToUp();t+n==1&&$("#NumId").focus()})}},getCurrentSection=function(){var n=0;return $(".page").filter((t,i)=>{$(i).is(":visible")&&(n=t)}),n},hasItemSelected=n=>n.items.length>0,sum=(...n)=>n.sum(),round=n=>{var t=2,i=0,r,u;return(""+n).includes("e")?(r=(""+n).split("e"),u="",+r[1]+t>0&&(u="+"),i=+(Math.round(+r[0]+"e"+u+(+r[1]+t))+"e-"+t),parseFloat(i).toFixed(2)):(i=+(Math.round(n+"e+"+t)+"e-"+t),parseFloat(i).toFixed(2))},format=n=>numeral(n).format("0,0.00"),allRows=()=>$("#coberturas tbody tr"),updateTD=function(n){return function(t,i){isTagSelect($(n),t)||$(n).find("td").eq(t).html(i)}},getEntity=n=>{let t=_entities.find(t=>t.name==n.name);return{name:n.name,action:n.action,key:function(){let i=t.models.find(n=>n.key);if(i)return i.getValue();if(!i)throw new Error(`No se ha establecido la propiedad key para la entidad ${n.name}`);}.apply(),isValid:function(){return n.action?t.models.isValidTo(n.action):!1}.apply(),source:function(){for(var i={},n=0;n<t.models.length;n++){const r=t.models[n];i[r.columnName||r.id]=r.getValue()}return i}.apply(),include:function(n){var t=getEntity({name:n,action:this.action});return this.isValid=this.isValid&&t.isValid,this[n]=t,this},getData:function(){var n={};for(const t in this)if(this.hasOwnProperty(t)){const i=this[t];if(t=="source")for(const t in i)i.hasOwnProperty(t)&&(n[t]=i[t]);else typeof i!="function"&&typeof i=="object"&&(n[t]=i.getData())}return n},save:function(){return this.key>0?this.update():this.create()},onSuccessCreate:function(){return t.onSuccessCreate}.apply(),onFailCreate:function(){return t.onFailCreate}.apply(),onSuccessUpdate:function(){return t.onSuccessUpdate}.apply(),onFailUpdate:function(){return t.onFailUpdate}.apply(),urlCreate:function(){return t.urlCreate}.apply(),urlUpdate:function(){return t.urlUpdate}.apply(),create:function(){return this.send(this.urlCreate,this.onSuccessCreate,this.onFailCreate,"post")},update:function(){return this.send(this.urlUpdate,this.onSuccessUpdate,this.onFailUpdate,"post")},send:function(n,t,i,r){return new Promise((u,f)=>{var e=function(n){t&&t(n);u(n)},o=function(n){i&&i(n);f(n)};ajax.full(`${n}`,this.getData(),e,o,r)})},_request:function(){}}},showNotify=function(n,t,i){$.niftyNoty({type:t,container:"floating",title:i,message:n,closeBtn:!0,timer:3e3})},isTagSelect=(n,t)=>$($(n).find("td").eq(t)[0].firstChild)[0].tagName=="A",hasData=function(n){var t=0;for(k in n.options)t++;return t!=0};var buildUrlWithValues=(n,t)=>{var i;let r=0,u="";while(n.includes("{")||n.includes("}")){if(u=n.substring(n.indexOf("{"),n.indexOf("}")+1),i=t[r],i==undefined)throw new Error(`La cantidad de valores (${t.join(",")}) no coincide con los esperados en la url ${n}`);n=n.replace(u,i);r++}return n},goToUp=function(){$("html, body").animate({scrollTop:0},"fast")},showLoading=function(){$("#panel-updatable").loading({message:"Guardando..."})},stopLoading=function(){$("#panel-updatable").loading("stop")},ajax={get:(n,t,i,r)=>{$.get(pathBase+n,t?t:null,i).fail(r||ajax.failResult)},post:(n,t,i,r)=>{$.post(pathBase+n,t?t:null,i).fail(r||ajax.failResult)},full:(n,t,i,r,u="post")=>{$.ajax({url:pathBase+n,type:u,dataType:"json",data:t,success:i,failure:r||ajax.failResult,error:r||ajax.failResult})},status:{BadRequest:400,Unauthorized:401,NotFound:404,IServerError:500},failResult:n=>{n.status==ajax.status.Unauthorized&&ajax.redirectToLogin(),n.status==ajax.status.IServerError?ajax.showMessage({responseJSON:"Error interno de la aplicación"},"danger"):ajax.showMessage(n,"danger")},redirectToLogin:()=>{window.location.href=pathBase+"cuenta/login"},showMessage:(n,t)=>{var i=typeof n.responseJSON=="object"?n.responseJSON.mensaje:n.responseJSON;$.niftyNoty({type:t||"success",container:"floating",title:"Error al guardar",message:i,closeBtn:!0,timer:3500})}},validate={validateField:n=>typeof n!="undefined"&&n!=null&&n!="",validateFieldZero:n=>typeof n!="undefined"&&n!=null&&n!=""&&n!="0",validateChange:n=>typeof n!="undefined"&&n.delegateTarget.value!=null&&n.delegateTarget.value!=""&&n.delegateTarget.value!="0",isNumber:n=>isNaN(parseFloat(n))||isFinite(n),isEmail:n=>{return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase())},validateLength:n=>({iquals:t=>n.length==t,between:(t,i)=>n.length>=t&&n.length<=i,greaterThan:t=>n.length>t}),hasAnyValue:n=>n.length>0,propertyIsValid:n=>{var i=!0,u=n.getValue(),r,t;return n.inputMinLength&&(r=$("#"+n.id).data("mask"),t=0,t=r?$("#"+n.id).cleanVal().length:String(u).length,n.inputMinLength>t&&(n.type==stores.types.phone?n.showMessage(`Ingrese ${n.inputMinLength} dígitos`):n.showMessage(`Ingrese ${n.inputMinLength} dígitos mínimo`),i=!1)),n.inputMaxLength&&(r=$("#"+n.id).data("mask"),t=0,t=r?$("#"+n.id).cleanVal().length:String(u).length,n.inputMaxLength<t&&(n.showMessage(`Solo se permite ${n.inputMaxLength} caracteres máximo`),i=!1)),n.type==stores.types.email&&(validate.isEmail(u)||(n.showMessage("Solo se permite formato de correo"),i=!1)),i},model:n=>{var t=!0,i=n.getValue();return validate.hasAnyValue($.trim(i))?validate.propertyIsValid(n)?n.clearError():t=!1:n.clearError(),t}};